(()=>{var t={917:(t,e)=>{"use strict";e.__esModule=!0,e.default=function(t,e){e.forEach((function(e){Object.getOwnPropertyNames(e.prototype).forEach((function(n){t.prototype[n]=e.prototype[n]}))}))}},406:t=>{t.exports=function(t,e){if("function"==typeof t.compare)return t.compare(e);if(t===e)return 0;for(var n=t.length,r=e.length,s=0,o=Math.min(n,r);s<o&&t[s]===e[s];)++s;return s!==o&&(n=t[s],r=e[s]),n<r?-1:r<n?1:0}},507:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(231);e.EventIterator=r.EventIterator,e.subscribe=function(t,e,n){return new r.EventIterator((({push:n})=>(this.addEventListener(t,n,e),()=>this.removeEventListener(t,n,e))),n)},e.default=r.EventIterator},231:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(t){if(this.isStopped)return;const e={value:t,done:!1};if(this.pullQueue.length){const t=this.pullQueue.shift();t&&t.resolve(e)}else this.pushQueue.push(Promise.resolve(e)),void 0!==this.highWaterMark&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const t of this.pullQueue)t.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(t){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const e of this.pullQueue)e.reject(t);this.pullQueue.length=0}else{const e=Promise.reject(t);e.catch((()=>{})),this.pushQueue.push(e)}}remove(){Promise.resolve().then((()=>{this.removeCallback&&this.removeCallback()}))}[Symbol.asyncIterator](){return{next:t=>{const e=this.pushQueue.shift();return e?(void 0!==this.lowWaterMark&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),e):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise(((t,e)=>{this.pullQueue.push({resolve:t,reject:e})}))},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class r{constructor(t,{highWaterMark:e=100,lowWaterMark:r=1}={}){const s=new n;s.highWaterMark=e,s.lowWaterMark=r,s.removeCallback=t({push:t=>s.push(t),stop:()=>s.stop(),fail:t=>s.fail(t),on:(t,e)=>{s.eventHandlers[t]=e}})||(()=>{}),this[Symbol.asyncIterator]=()=>s[Symbol.asyncIterator](),Object.freeze(this)}}e.EventIterator=r,e.default=r},217:(t,e,n)=>{const r=n(306),s={};t.exports=(t,e)=>(e=e||{},n=>{let o;return n=r(n),{[Symbol.asyncIterator](){return this},async next(){for(;;){let r;o||(o=n.next());const i=new Promise((t=>{r=setTimeout((()=>t({value:s})),e.timeout||1e3)})),{done:a,value:c}=await Promise.race([i,o]);if(clearTimeout(r),a)return{done:a};if(c!==s)return o=null,{value:c};if(!e.shouldKeepAlive||e.shouldKeepAlive())return{value:t()}}},return(){if(n.return)return n.return()}}})},306:t=>{t.exports=function(t){if(t){if("function"==typeof t[Symbol.iterator])return t[Symbol.iterator]();if("function"==typeof t[Symbol.asyncIterator])return t[Symbol.asyncIterator]();if("function"==typeof t.next)return t}throw new Error("argument is not an iterator or iterable")}},746:t=>{function e(t,e){if(!t)throw new Error(e||"Assertion failed")}t.exports=e,e.equal=function(t,e,n){if(t!=e)throw new Error(n||"Assertion failed: "+t+" != "+e)}},20:t=>{function e(t){if("function"!=typeof t)throw new Error("mnemonist/DefaultMap.constructor: expecting a function.");this.items=new Map,this.factory=t,this.size=0}e.prototype.clear=function(){this.items.clear(),this.size=0},e.prototype.get=function(t){var e=this.items.get(t);return void 0===e&&(e=this.factory(t,this.size),this.items.set(t,e),this.size++),e},e.prototype.peek=function(t){return this.items.get(t)},e.prototype.set=function(t,e){return this.items.set(t,e),this.size=this.items.size,this},e.prototype.has=function(t){return this.items.has(t)},e.prototype.delete=function(t){var e=this.items.delete(t);return this.size=this.items.size,e},e.prototype.forEach=function(t,e){e=arguments.length>1?e:this,this.items.forEach(t,e)},e.prototype.entries=function(){return this.items.entries()},e.prototype.keys=function(){return this.items.keys()},e.prototype.values=function(){return this.items.values()},"undefined"!=typeof Symbol&&(e.prototype[Symbol.iterator]=e.prototype.entries),e.prototype.inspect=function(){return this.items},"undefined"!=typeof Symbol&&(e.prototype[Symbol.for("nodejs.util.inspect.custom")]=e.prototype.inspect),e.autoIncrement=function(){var t=0;return function(){return t++}},t.exports=e},663:t=>{function e(t){if("function"!=typeof t)throw new Error("mnemonist/DefaultWeakMap.constructor: expecting a function.");this.items=new WeakMap,this.factory=t}e.prototype.clear=function(){this.items=new WeakMap},e.prototype.get=function(t){var e=this.items.get(t);return void 0===e&&(e=this.factory(t),this.items.set(t,e)),e},e.prototype.peek=function(t){return this.items.get(t)},e.prototype.set=function(t,e){return this.items.set(t,e),this},e.prototype.has=function(t){return this.items.has(t)},e.prototype.delete=function(t){return this.items.delete(t)},e.prototype.inspect=function(){return this.items},"undefined"!=typeof Symbol&&(e.prototype[Symbol.for("nodejs.util.inspect.custom")]=e.prototype.inspect),t.exports=e},353:(t,e,n)=>{t.exports=n(846)},846:(t,e,n)=>{var r=n(960);e.operation=function(t){var n=e.timeouts(t);return new r(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},e.timeouts=function(t){if(t instanceof Array)return[].concat(t);var e={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var n in t)e[n]=t[n];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],s=0;s<e.retries;s++)r.push(this.createTimeout(s,e));return t&&t.forever&&!r.length&&r.push(this.createTimeout(s,e)),r.sort((function(t,e){return t-e})),r},e.createTimeout=function(t,e){var n=e.randomize?Math.random()+1:1,r=Math.round(n*Math.max(e.minTimeout,1)*Math.pow(e.factor,t));return Math.min(r,e.maxTimeout)},e.wrap=function(t,n,r){if(n instanceof Array&&(r=n,n=null),!r)for(var s in r=[],t)"function"==typeof t[s]&&r.push(s);for(var o=0;o<r.length;o++){var i=r[o],a=t[i];t[i]=function(r){var s=e.operation(n),o=Array.prototype.slice.call(arguments,1),i=o.pop();o.push((function(t){s.retry(t)||(t&&(arguments[0]=s.mainError()),i.apply(this,arguments))})),s.attempt((function(){r.apply(t,o)}))}.bind(t,a),t[i].options=n}}},960:t=>{function e(t,e){"boolean"==typeof e&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}t.exports=e,e.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},e.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},e.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=(new Date).getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(t),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var n=this._timeouts.shift();if(void 0===n){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1)}var r=this;return this._timer=setTimeout((function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout((function(){r._operationTimeoutCb(r._attempts)}),r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)}),n),this._options.unref&&this._timer.unref(),!0},e.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){n._operationTimeoutCb()}),n._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},e.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)},e.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)},e.prototype.start=e.prototype.try,e.prototype.errors=function(){return this._errors},e.prototype.attempts=function(){return this._attempts},e.prototype.mainError=function(){if(0===this._errors.length)return null;for(var t={},e=null,n=0,r=0;r<this._errors.length;r++){var s=this._errors[r],o=s.message,i=(t[o]||0)+1;t[o]=i,i>=n&&(e=s,n=i)}return e}}},e={};function n(r){var s=e[r];if(void 0!==s)return s.exports;var o=e[r]={exports:{}};return t[r](o,o.exports,n),o.exports}(()=>{"use strict";function t(t){return t&&t.__esModule?t:{default:t}}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var e=n(746);const r=t(e).default;var s=class extends EventTarget{dispatchTypedEvent(t,e){return super.dispatchEvent(e)}};const o={};for(let t=0;t<=255;++t)o[t]=t.toString(16).padStart(2,"0").toUpperCase();const i={};for(let t=0;t<=15;++t){const e=t.toString(16);i[e.toLowerCase()]=t,i[e.toUpperCase()]=t}function a(t){let e="";for(const n of t)e+=o[n];return e}function c(t){const e=new Uint8Array(t.length/2);for(let n=0;n<e.length;++n)e[n]=i[t[2*n]]<<4|i[t[2*n+1]];return e}!function(t){t.TABLE=o}(a||(a={})),function(t){t.TABLE=i}(c||(c={}));const u=new TextEncoder,h=new TextDecoder;function f(t){return h.decode(t)}function l(t){return function(t,e){return e instanceof t?e:e instanceof ArrayBuffer?new t(e):new t(e.buffer,e.byteOffset,e.byteLength)}(DataView,t)}class d{n;constructor(t){this.n=t}encodeTo(t){t.prependRoom(1)[0]=this.n}}class p{n;constructor(t){this.n=t}encodeTo(t){l(t.prependRoom(2)).setUint16(0,this.n)}}class m{n;constructor(t){this.n=t}encodeTo(t){l(t.prependRoom(4)).setUint32(0,this.n)}}class y{n;constructor(t){this.n=t}encodeTo(t){const e=l(t.prependRoom(8));e.setUint32(0,this.n/4294967296),e.setUint32(4,this.n)}}class w{n;constructor(t){this.n=t}encodeTo(t){l(t.prependRoom(8)).setBigUint64(0,this.n)}}function g(t){switch(t.byteLength){case 1:return t.getUint8(0);case 2:return t.getUint16(0);case 4:return t.getUint32(0)}throw new Error("incorrect TLV-LENGTH of NNI")}const v={1:d,2:p,4:m,8:y};function b(t,{len:e,unsafe:n=!1}={}){if(e)return 8===e&&"bigint"==typeof t?new w(t):new v[e](Number(t));if("bigint"==typeof t)switch(!0){case t<0x100000000n:t=Number(t);break;case t<=0xffffffffffffffffn:return new w(t);default:throw new RangeError("NNI is too large")}switch(!0){case t<0:throw new RangeError("NNI cannot be negative");case t<256:return new d(t);case t<65536:return new p(t);case t<4294967296:return new m(t);case t<=(n?0x10000000000000000:Number.MAX_SAFE_INTEGER):return new y(t);default:throw new RangeError("NNI is too large")}}!function(t){t.isValidLength=function(t){return!!v[t]},t.decode=function(t,{len:e,big:n=!1,unsafe:r=!1}={}){if(e&&t.byteLength!==e)throw new Error(`incorrect TLV-LENGTH of NNI${e}`);const s=l(t);if(n)return 8===s.byteLength?s.getBigUint64(0):BigInt(g(s));if(8===s.byteLength){const e=4294967296*s.getUint32(0)+s.getUint32(4);if(!r&&!Number.isSafeInteger(e))throw new RangeError(`NNI is too large ${a(t)}`);return e}return g(s)},t.constrain=function(t,e,n,r){const[s=0,o=Number.MAX_SAFE_INTEGER]="number"==typeof r?[n,r]:[0,n];if(!(t>=s&&t<=o))throw new RangeError(`${t} is out of ${e} valid range`);return Math.trunc(t)}}(b||(b={}));class E{type;buf;offsetT;offsetV;offsetE;get length(){return this.offsetE-this.offsetV}get value(){return this.buf.subarray(this.offsetV,this.offsetE)}get tlv(){return this.buf.subarray(this.offsetT,this.offsetE)}get size(){return this.offsetE-this.offsetT}get decoder(){return new x(this.tlv)}get vd(){return new x(this.value)}get nni(){return b.decode(this.value)}get nniBig(){return b.decode(this.value,{big:!0})}get text(){return f(this.value)}get before(){return this.buf.subarray(0,this.offsetT)}get after(){return this.buf.subarray(this.offsetE)}constructor(t,e,n,r,s){this.type=t,this.buf=e,this.offsetT=n,this.offsetV=r,this.offsetE=s}}class x{input;get eof(){return this.offset>=this.input.length}dv;offset=0;constructor(t){this.input=t,this.dv=l(t)}read(){const t=this.offset,e=this.readVarNum(),n=this.readVarNum(),r=this.offset;if(void 0===n||(this.offset+=n)>this.input.length)throw new Error(`TLV at offset ${t} is incomplete`);return new E(e,this.input,t,r,this.offset)}decode(t){return t.decodeFrom(this)}readVarNum(){if(!this.eof)switch(this.input[this.offset]){case 253:if(this.offset+=3,this.offset>this.input.length)return;return this.dv.getUint16(this.offset-2);case 254:if(this.offset+=5,this.offset>this.input.length)return;return this.dv.getUint32(this.offset-4);case 255:return;default:return this.offset+=1,this.input[this.offset-1]}}}const T=t(e).default;function k(t){if(t<253)return 1;if(t<=65535)return 3;if(t<=4294967295)return 5;throw new Error("VAR-NUMBER is too large")}function S(t,e,n){n<253?t[e++]=n:n<=65535?(t[e++]=253,l(t).setUint16(e,n)):(t[e++]=254,l(t).setUint32(e,n))}class P{buf;off;get size(){return this.buf.byteLength-this.off}get output(){return this.slice()}constructor(t=2048){this.buf=new ArrayBuffer(t),this.off=t}slice(t=0,e){return new Uint8Array(this.buf,this.off+t,e)}prependRoom(t){return this.off<t&&this.grow(t),this.off-=t,this.slice(0,t)}prependTypeLength(t,e){const n=k(t),r=k(e),s=this.prependRoom(n+r);S(s,0,t),S(s,n,e)}prependValue(...t){for(let e=t.length-1;e>=0;--e)this.encode(t[e])}prependTlv(t,e,...n){const r=e===P.OmitEmpty;r||n.unshift(e);const s=this.size;this.prependValue(...n);const o=this.size-s;(o>0||!r)&&this.prependTypeLength(t,o)}encode(t){t instanceof Uint8Array?this.prependRoom(t.byteLength).set(t):"object"==typeof t&&"function"==typeof t.encodeTo?t.encodeTo(this):Array.isArray(t)?"number"==typeof t[0]?this.prependTlv(...t):this.prependValue(...t):T(void 0===t||!1===t,"obj is not Encodable")}grow(t){const e=2048+t,n=new ArrayBuffer(e+this.size);new Uint8Array(n,e).set(this.output),this.buf=n,this.off=e}}!function(t){t.OmitEmpty=Symbol("OmitEmpty"),t.encode=function(e,n){const r=new t(n);return r.encode(e),r.output},t.extract=function(t,e){return{encodeTo(n){const r=n.size;n.encode(t),e(n.slice(0,n.size-r))}}}}(P||(P={}));const L=t(n(406)).default;function I(t){return Number.isInteger(t)&&t>=1&&t<=65535}const A={};for(let t=0;t<=255;++t){const e=String.fromCodePoint(t);A[t]=/[\w.~-]/i.test(e)?e:`%${a.TABLE[t]}`}const _="%".codePointAt(0),N=".".codePointAt(0);class R{static decodeFrom(t){const{tlv:e}=t.read();return new R(e)}static from(t){if(t instanceof R)return t;let e=8,n=0;const r=t.indexOf("=");if(r>=1){const s=Number.parseInt(t,10);I(s)&&(e=s,n=r+1)}const s=new Uint8Array(t.length-n);let o=0,i=!1;for(let e=n;e<t.length;){let n=t.codePointAt(e);i||=n!==N,n===_?(n=c.TABLE[t[e+1]]<<4|c.TABLE[t[e+2]],e+=3):++e,s[o++]=n}return!i&&o>=3&&(o-=3),new R(e,s.subarray(0,o))}tlv;type;value;get length(){return this.value.length}get text(){return f(this.value)}constructor(t=8,e=new Uint8Array){if(t instanceof Uint8Array){this.tlv=t;const e=new x(t);({type:this.type,value:this.value}=e.read())}else this.type=t,"string"==typeof e&&(n=e,e=u.encode(n)),this.tlv=P.encode([this.type,e],10+e.length),this.value=this.tlv.subarray(this.tlv.length-e.length);var n;!function(t){if(!I(t))throw new Error(`Component TLV-TYPE ${t} out of range`)}(this.type)}toString(){let t=`${this.type}=`,e=!1;for(const n of this.value)e||=n!==N,t+=A[n];return e||(t+="..."),t}encodeTo(t){t.encode(this.tlv)}is(t){return t.match(this)}as(t){if(!t.match(this))throw new Error("component does not follow convention");return t.parse(this)}compare(t){return t=R.from(t),2*Math.sign(this.type-t.type||this.length-t.length||L(this.value,t.value))}equals(t){return this.compare(t)===R.CompareResult.EQUAL}}!function(t){let e;!function(t){t[t.LT=-2]="LT",t[t.EQUAL=0]="EQUAL",t[t.GT=2]="GT"}(e=t.CompareResult||(t.CompareResult={}))}(R||(R={}));class D{static decodeFrom(t){const{value:e}=t.read();return new D(e)}comps;constructor(t,e=R.from){switch(!0){case t instanceof D:{const e=t;this.comps=e.comps,this.value_=e.value_;break}case"string"==typeof t:{const n=t;this.comps=n.replace(/^(?:ndn:)?\/*/,"").split("/").filter((t=>""!==t)).map(e),this.valueEncoderBufSize=n.length+4*this.comps.length;break}case Array.isArray(t):this.comps=Array.from(t,R.from);break;case t instanceof Uint8Array:{this.value_=t;const e=[],n=new x(this.value_);for(;!n.eof;)e.push(n.decode(R));this.comps=e;break}default:this.comps=[],this.valueEncoderBufSize=0}}valueEncoderBufSize;value_;uri_;hex_;get length(){return this.comps.length}get value(){return this.value_||(this.value_=P.encode(this.comps,this.valueEncoderBufSize??256)),this.value_}get valueHex(){return this.hex_??=a(this.value),this.hex_}get(t){return t=t<0?t+this.length:t,this.comps[t]}at(t){const e=this.get(t);if(!e)throw new Error(`component ${t} out of range`);return e}toString(){return this.uri_??=`/${this.comps.map((t=>t.toString())).join("/")}`,this.uri_}slice(t,e){return new D(this.comps.slice(t,e))}getPrefix(t){return this.slice(0,t)}append(...t){let e;return e=2===t.length&&"function"==typeof t[0].create?[t[0].create(t[1])]:t,new D([...this.comps,...e])}replaceAt(t,e){const n=[...this.comps];return n.splice(t,1,e),new D(n)}compare(t){t=D.from(t);const e=Math.min(this.length,t.length),n=this.comparePrefix(t,e);return n!==D.CompareResult.EQUAL?n:this.length>e?D.CompareResult.RPREFIX:t.length>e?D.CompareResult.LPREFIX:D.CompareResult.EQUAL}equals(t){return t=D.from(t),void 0!==this.hex_&&void 0!==t.hex_?this.hex_===t.hex_:this.length===t.length&&this.comparePrefix(t,this.length)===D.CompareResult.EQUAL}isPrefixOf(t){return t=D.from(t),this.length<=t.length&&this.comparePrefix(t,this.length)===D.CompareResult.EQUAL}comparePrefix(t,e){for(let n=0;n<e;++n){const e=this.comps[n].compare(t.comps[n]);if(e!==R.CompareResult.EQUAL)return e}return D.CompareResult.EQUAL}encodeTo(t){this.value_?t.prependTlv(7,this.value_):t.prependTlv(7,...this.comps)}}!function(t){let e;t.isNameLike=function(e){return e instanceof t||"string"==typeof e},t.from=function(e){return e instanceof t?e:new t(e)},function(t){t[t.LT=-2]="LT",t[t.LPREFIX=-1]="LPREFIX",t[t.EQUAL=0]="EQUAL",t[t.RPREFIX=1]="RPREFIX",t[t.GT=2]="GT"}(e=t.CompareResult||(t.CompareResult={}))}(D||(D={}));class O{keyOf;constructor(t){this.keyOf=t}m=new Map;get size(){return this.m.size}has(t){return this.m.has(this.keyOf(t))}get(t){return this.m.get(this.keyOf(t))?.[1]}set(t,e){return this.m.set(this.keyOf(t),[t,e]),this}delete(t){return this.m.delete(this.keyOf(t))}[Symbol.iterator](){return this.m.values()}}class U{constructor(t){this.m=new O(t)}m;size_=0;get dimension(){return this.m.size}get size(){return this.size_}count(t){return this.m.get(t)?.size??0}list(t){return this.m.get(t)??new Set}add(t,e){let n=this.m.get(t);n||(n=new Set,this.m.set(t,n));const r=n.size;return n.add(e),this.size_+=n.size-r,n.size}remove(t,e){const n=this.m.get(t);if(!n)return 0;const r=n.size;return n.delete(e),this.size_+=n.size-r,0===n.size&&this.m.delete(t),n.size}associations(){return this.m[Symbol.iterator]()}*[Symbol.iterator](){for(const[t,e]of this.associations())for(const n of e)yield[t,n]}}class M{constructor(t){this.m=new O(t)}m;size_=0;get dimension(){return this.m.size}get size(){return this.size_}count(t){return this.m.get(t)??0}add(t){const e=this.count(t)+1;return this.m.set(t,e),++this.size_,e}remove(t){let e=this.count(t);return 0===e||(--this.size_,--e,0===e?this.m.delete(t):this.m.set(t,e)),e}multiplicities(){return this.m[Symbol.iterator]()}}function C(t){return"string"==typeof t?t:t.valueHex}class F extends O{constructor(){super(C)}}class B extends U{constructor(){super(C)}}class z extends M{constructor(){super(C)}}function $(t){const e=t.toString(16).toUpperCase();return t<253?`0x${e.padStart(2,"0")}`:t<=65535?`0x${e.padStart(4,"0")}`:`0x${e.padStart(8,"0")}`}function V(t){return t<=31||t%2==1}class q{typeName;topTT;rules=new Map;requiredTT=new Set;nextOrder=100;isCritical=V;unknownHandler;beforeObservers=[];afterObservers=[];constructor(t,e=[]){this.typeName=t,this.topTT=Array.isArray(e)?e:[e]}add(t,e,{order:n=(this.nextOrder+=100),required:r=!1,repeat:s=!1}={}){var o;return T(!this.rules.has(t),"duplicate rule for same TLV-TYPE"),this.rules.set(t,{cb:e instanceof q?(o=e,(t,{decoder:e})=>{o.decode(t,e)}):e,order:n,required:r,repeat:s}),r&&this.requiredTT.add(t),this}setIsCritical(t){return this.isCritical=t,this}setUnknown(t){return this.unknownHandler=t,this}decode(t,e){const n=e.read(),{type:r,vd:s}=n;if(this.topTT.length>0&&!this.topTT.includes(r))throw new Error(`TLV-TYPE ${$(r)} is not ${this.typeName}`);return this.decodeV(t,s,n)}decodeValue(t,e){return this.decodeV(t,e)}decodeV(t,e,n){for(const e of this.beforeObservers)e(t,n);let r=0;const s=new Set,o=new Set(this.requiredTT);for(;!e.eof;){const n=e.read(),i=n.type,a=this.rules.get(i);if(a)if(r>a.order)this.handleUnrecognized(i,"out of order");else{if(r=a.order,!a.repeat&&s.has(i))throw new Error(`TLV-TYPE ${$(i)} cannot repeat in ${this.typeName}`);s.add(i),o.delete(i),a.cb(t,n)}else this.unknownHandler?.(t,n,r)||this.handleUnrecognized(i,"unknown")}if(o.size>0)throw new Error(`TLV-TYPE ${Array.from(o,$).join(",")} missing in ${this.typeName}`);for(const e of this.afterObservers)e(t,n);return t}handleUnrecognized(t,e){if(this.isCritical(t))throw new Error(`TLV-TYPE ${$(t)} is ${e} in ${this.typeName}`)}}const W=t(e).default,H=globalThis.console,j=globalThis.crypto;j.subtle||globalThis.isSecureContext||Object.defineProperty(j,"subtle",{configurable:!0,get(){H.error("NDNts depends on Web Crypto but it is unavailable because this webpage is not delivered securely, see https://mdn.io/SecureContext")}});const Q=globalThis.CustomEvent;async function G(t){const e=await j.subtle.digest("SHA-256",t);return new Uint8Array(e)}const X=new q("FwHint").add(7,((t,{decoder:e})=>t.push(e.decode(D))),{repeat:!0});class Y{static decodeValue(t){const e=new Y;return X.decodeValue(e.delegations,t),e}constructor(t){if(Array.isArray(t))for(const e of t)this.delegations.push(D.from(e));else t instanceof Y?this.delegations=[...t.delegations]:D.isNameLike(t)&&(this.delegations=[D.from(t)])}delegations=[];encodeTo(t){t.prependTlv(30,P.OmitEmpty,...this.delegations)}}const K=Symbol("FIELDS");function J(t,e){for(const[n,r]of Object.entries(e))Object.defineProperty(t.prototype,n,{enumerable:!0,get(){return this[K][n]},set(t){const e=this[K];e[n]=t;for(const t of r)e[t]=void 0}})}class Z{tt;altUriPrefix;altUriRegex;constructor(t,e){this.tt=t,this.altUriPrefix=e,this.altUriRegex=new RegExp(`^${e}=([0-9a-fA-F]{64})$`)}match(t){return t.type===this.tt&&32===t.length}create(t){if(32!==t.length)throw new Error("digest length must be 32");return new R(this.tt,t)}parse(t){return t.value}toAltUri(t){return`${this.altUriPrefix}=${a(t.value).toLowerCase()}`}fromAltUri(t){const e=this.altUriRegex.exec(t);if(e)return new R(this.tt,c(e[1]))}}const tt=new class extends Z{constructor(){super(1,"sha256digest")}strip(t){return t.get(-1)?.is(this)?t.getPrefix(-1):t}},et=Symbol("ParametersSha256DigestComponent.placeholder"),nt=new class extends Z{PLACEHOLDER;constructor(){super(2,"params-sha256"),this.PLACEHOLDER=Object.assign(new R(2),{[et]:!0})}isPlaceholder(t){return!!t[et]}findIn(t,e=!0){return t.comps.findIndex((t=>this.match(t)||e&&this.isPlaceholder(t)))}},rt=new q("KeyLocator",28).add(7,((t,{value:e})=>t.name=new D(e))).add(29,((t,{value:e})=>t.digest=e));class st{static decodeFrom(t){return rt.decode(new st,t)}name;digest;constructor(...t){for(const e of t)if(D.isNameLike(e))this.name=D.from(e);else if(e instanceof Uint8Array)this.digest=e;else{if(!(e instanceof st))throw new Error("unknown KeyLocator constructor argument");Object.assign(this,e)}}encodeTo(t){t.prependTlv(28,P.OmitEmpty,this.name,[29,P.OmitEmpty,this.digest])}}!function(t){t.isCtorArg=function(e){return e instanceof t||D.isNameLike(e)||e instanceof Uint8Array},t.mustGetName=function(t){const e=t?.name;if(!e)throw new Error("KeyLocator does not have name");return e}}(st||(st={}));const ot=new(0,t(n(663)).default)((()=>new Map));var it,at;!function(t){t.TAG=Symbol("Extensible"),t.cloneRecord=function(t,e){ot.set(t,new Map(ot.get(e)))}}(it||(it={})),function(t){t.get=function(t,e){return ot.get(t).get(e)},t.set=function(t,e,n){ot.get(t).set(e,n)},t.clear=function(t,e){ot.get(t).delete(e)}}(at||(at={}));const ct=new class{table=new Map;registerExtension=t=>{this.table.set(t.tt,t)};unregisterExtension=t=>{this.table.delete(t)};decodeUnknown=(t,e,n)=>{const{type:r}=e,s=this.table.get(r);if(!s)return!1;const o=ot.get(t);return o.set(r,s.decode(t,e,o.get(r))),!0};encode(t){const e=ot.peek(t);if(!e)return[];const n=[];for(const[t,r]of e){const e=this.table.get(t);if(!e)throw new Error(`unknown extension type ${t}`);n.push({tt:t,value:r,ext:e})}return n.sort(((t,e)=>(t.ext.order??t.tt)-(e.ext.order??e.tt))),n.map((({value:e,ext:n})=>n.encode(t,e)))}},ut=new q("SigInfo",[44,22]).add(27,((t,{nni:e})=>t.type=e),{required:!0}).add(28,((t,{decoder:e})=>t.keyLocator=e.decode(st))).add(38,((t,{value:e})=>t.nonce=e)).add(40,((t,{nni:e})=>t.time=e)).add(42,((t,{nniBig:e})=>t.seqNum=e)).setUnknown(ct.decodeUnknown);class ht{static decodeFrom(t){return ut.decode(new ht,t)}type=200;keyLocator;nonce;time;seqNum;[it.TAG]=ct;constructor(...t){const e=[];for(const n of t)if("number"==typeof n)this.type=n;else if(st.isCtorArg(n))e.push(n);else if(n instanceof ht)Object.assign(this,n),it.cloneRecord(this,n);else{if(!n[ft])throw new Error("unknown SigInfo constructor argument");n[ft](this)}e.length>0&&(this.keyLocator=new st(...e))}encodeAs(t){return{encodeTo:e=>this.encodeTo(e,t)}}encodeTo(t,e){t.prependTlv(e,[27,b(this.type)],this.keyLocator,[38,P.OmitEmpty,this.nonce],void 0!==this.time&&[40,b(this.time)],void 0!==this.seqNum&&[42,b(this.seqNum)],...ct.encode(this))}}const ft=Symbol("SigInfo.ctorAssign");var lt,dt,pt,mt;!function(t){function e(t=8){return T(t>=1),j.getRandomValues(new Uint8Array(t))}t.Nonce=function(t){return{[ft](n){n.nonce=t instanceof Uint8Array?t:e(t)}}},t.generateNonce=e,t.Time=function(t=Date.now()){return{[ft](e){e.time=t}}},t.SeqNum=function(t){return{[ft](e){e.seqNum=t}}},t.registerExtension=ct.registerExtension,t.unregisterExtension=ct.unregisterExtension}(ht||(ht={})),function(t){t.OP=Symbol("LLSign.OP")}(lt||(lt={})),function(t){t.OP=Symbol("LLVerify.OP")}(dt||(dt={})),function(t){t.putSigInfo=function(t,e,n){return t.sigInfo??=new ht,void 0!==e&&(t.sigInfo.type=e),!1===n?t.sigInfo.keyLocator=void 0:void 0!==n&&(t.sigInfo.keyLocator=new st(n)),t.sigInfo}}(pt||(pt={})),function(t){t.checkSigType=function(t,e){if(t.sigInfo?.type!==e)throw new Error(`packet does not have SigType ${e}`)},t.throwOnBadSig=function(t){if(!t)throw new Error("bad signature value")}}(mt||(mt={}));class yt{constructor(...t){for(const e of t)if(D.isNameLike(e))this.name=D.from(e);else if(e instanceof Y)this.fwHint=new Y(e);else if(e instanceof Uint8Array)this.appParameters=e;else if(e instanceof gt)Object.assign(this,e[K]);else{if(!e[vt])throw new Error("unknown Interest constructor argument");e[vt](this)}}name=new D;canBePrefix=!1;mustBeFresh=!1;fwHint;get nonce(){return this.nonce_}set nonce(t){this.nonce_=t&&b.constrain(t,"Nonce",4294967295)}nonce_;get lifetime(){return this.lifetime_}set lifetime(t){this.lifetime_=b.constrain(t,"InterestLifetime")}lifetime_=gt.DefaultLifetime;get hopLimit(){return this.hopLimit_}set hopLimit(t){this.hopLimit_=b.constrain(t,"HopLimit",255)}hopLimit_=255;appParameters;sigInfo;sigValue=new Uint8Array;paramsPortion;signedPortion}const wt=new q("Interest",5).add(7,((t,{decoder:e})=>t.name=e.decode(D)),{required:!0}).add(33,(t=>t.canBePrefix=!0)).add(18,(t=>t.mustBeFresh=!0)).add(30,((t,{vd:e})=>t.fwHint=Y.decodeValue(e))).add(10,((t,{value:e})=>t.nonce=b.decode(e,{len:4}))).add(12,((t,{nni:e})=>t.lifetime=e)).add(34,((t,{value:e})=>t.hopLimit=b.decode(e,{len:1}))).add(36,((t,{value:e,tlv:n,after:r})=>{if(nt.findIn(t.name,!1)<0)throw new Error("ParamsDigest missing in parameterized Interest");t.appParameters=e,T(n.buffer===r.buffer),t.paramsPortion=new Uint8Array(n.buffer,n.byteOffset,n.byteLength+r.byteLength)})).add(44,((t,{decoder:e})=>t.sigInfo=e.decode(ht))).add(46,((t,{value:e,tlv:n})=>{if(!t.name.get(-1)?.is(nt))throw new Error("ParamsDigest missing or out of place in signed Interest");if(!t.paramsPortion)throw new Error("AppParameters missing in signed Interest");if(!t.sigInfo)throw new Error("ISigInfo missing in signed Interest");T(n.buffer===t.paramsPortion.buffer),t.sigValue=e;const r=t.name.value.subarray(0,-t.name.get(-1).tlv.byteLength),s=new Uint8Array(n.buffer,t.paramsPortion.byteOffset,n.byteOffset-t.paramsPortion.byteOffset);t.signedPortion=new Uint8Array(r.byteLength+s.byteLength),t.signedPortion.set(r,0),t.signedPortion.set(s,r.byteLength)}));class gt{constructor(...t){this[K]=new yt(...t)}[K];static decodeFrom(t){const e=new gt;return wt.decode(e[K],t),e}encodeTo(t){const{name:e,canBePrefix:n,mustBeFresh:r,fwHint:s,nonce:o,lifetime:i,hopLimit:a,appParameters:c}=this[K];if(0===e.length)throw new Error("invalid empty Interest name");if(c&&nt.findIn(e,!1)<0)throw new Error("ParamsDigest missing");t.prependTlv(5,e,n&&[33],r&&[18],s,[10,b(o??gt.generateNonce(),{len:4})],i!==gt.DefaultLifetime&&[12,b(i)],255!==a&&[34,b(a,{len:1})],...this.encodeParamsPortion())}encodeParamsPortion(){const{appParameters:t,sigInfo:e,sigValue:n}=this[K];if(!t)return[];const r=[[36,t]];return e&&r.push(e.encodeAs(44),[46,n]),r}appendParamsDigestPlaceholder(){const t=this[K];return this.name=t.name.append(nt.PLACEHOLDER),t.name.length-1}async updateParamsDigest(){const t=this[K];let e=nt.findIn(t.name);e<0&&(e=this.appendParamsDigestPlaceholder()),t.appParameters??=new Uint8Array,t.paramsPortion=P.encode(this.encodeParamsPortion());const n=await G(t.paramsPortion);t.name=t.name.replaceAt(e,nt.create(n))}async validateParamsDigest(t=!1){const{appParameters:e,paramsPortion:n,name:r}=this[K];if(!e){if(t)throw new Error("AppParameters is missing");return}if(!n)throw new Error("parameters portion is empty");const s=r.at(nt.findIn(r,!1)),o=await G(n);if(!s.equals(nt.create(o)))throw new Error("incorrect ParamsDigest")}async[lt.OP](t){const e=this[K];let n=nt.findIn(e.name);if(n<0)n=this.appendParamsDigestPlaceholder();else if(n!==e.name.length-1)throw new Error("ParamsDigest out of place for signed Interest");return e.signedPortion=P.encode([...e.name.getPrefix(-1).comps,[36,e.appParameters],e.sigInfo?.encodeAs(44)]),this.sigValue=await t(e.signedPortion),this.updateParamsDigest()}async[dt.OP](t){const{signedPortion:e,sigValue:n}=this[K];if(await this.validateParamsDigest(),!e)throw new Error("SignedPortion is missing");await t(e,n)}}J(gt,{name:["signedPortion"],canBePrefix:[],mustBeFresh:[],fwHint:[],nonce:[],lifetime:[],hopLimit:[],appParameters:["paramsPortion","signedPortion"],sigInfo:["paramsPortion","signedPortion"],sigValue:["paramsPortion"]});const vt=Symbol("Interest.ctorAssign");!function(t){function e(){return Math.trunc(4294967296*Math.random())}t.generateNonce=e,t.DefaultLifetime=4e3,t.CanBePrefix={[vt](t){t.canBePrefix=!0}},t.MustBeFresh={[vt](t){t.mustBeFresh=!0}},t.Nonce=function(t=e()){return{[vt](e){e.nonce=t}}},t.Lifetime=function(t){return{[vt](e){e.lifetime=t}}},t.HopLimit=function(t){return{[vt](e){e.hopLimit=t}}},t.makeModifyFunc=function(t){if(!t)return()=>{};if("function"==typeof t)return t;const e={};for(const n of["canBePrefix","mustBeFresh","fwHint","lifetime","hopLimit"])void 0!==t[n]&&(e[n]=t[n]);return t=>{Object.assign(t,e)}}}(gt||(gt={}));class bt{constructor(...t){let e=!1;for(const n of t)if(D.isNameLike(n))this.name=D.from(n);else if(n instanceof Uint8Array)this.content=n;else if(n===xt.FinalBlock)e=!0;else if(n instanceof xt)Object.assign(this,n[K]);else{if(!n[kt])throw new Error("unknown Data constructor argument");n[kt](this)}this.isFinalBlock=e}name=new D;get contentType(){return this.contentType_}set contentType(t){this.contentType_=b.constrain(t,"ContentType")}contentType_=0;get freshnessPeriod(){return this.freshnessPeriod_}set freshnessPeriod(t){this.freshnessPeriod_=b.constrain(t,"FreshnessPeriod")}freshnessPeriod_=0;finalBlockId;get isFinalBlock(){return!!this.finalBlockId&&this.name.length>0&&this.finalBlockId.equals(this.name.get(-1))}set isFinalBlock(t){if(t){if(0===this.name.length)throw new Error("cannot set FinalBlockId when Name is empty");this.finalBlockId=this.name.get(-1)}else this.finalBlockId=void 0}content=new Uint8Array;sigInfo=new ht;sigValue=new Uint8Array;signedPortion;topTlv;topTlvDigest}const Et=new q("Data",6).add(7,((t,{decoder:e})=>t.name=e.decode(D)),{required:!0}).add(20,new q("MetaInfo").add(24,((t,{nni:e})=>t.contentType=e)).add(25,((t,{nni:e})=>t.freshnessPeriod=e)).add(26,((t,{vd:e})=>t.finalBlockId=e.decode(R)))).add(21,((t,{value:e})=>t.content=e)).add(22,((t,{decoder:e})=>t.sigInfo=e.decode(ht)),{required:!0}).add(23,((t,{value:e,before:n})=>{t.sigValue=e,t.signedPortion=n}),{required:!0});Et.beforeObservers.push(((t,e)=>t.topTlv=e.tlv));class xt{constructor(...t){this[K]=new bt(...t)}[K];static decodeFrom(t){const e=new xt;return Et.decode(e[K],t),e}encodeTo(t){const e=this[K];e.topTlv?t.encode(e.topTlv):t.encode(P.extract([6,P.extract(this.encodeSignedPortion(),(t=>e.signedPortion=t)),[23,e.sigValue]],(t=>e.topTlv=t)))}encodeSignedPortion(){const{name:t,contentType:e,freshnessPeriod:n,finalBlockId:r,content:s,sigInfo:o}=this[K];return[t,[20,P.OmitEmpty,e>0&&[24,b(e)],n>0&&[25,b(n)],r&&[26,r]],s.length>0&&[21,s],o.encodeAs(22)]}getImplicitDigest(){return this[K].topTlvDigest}async computeImplicitDigest(){let t=this.getImplicitDigest();if(!t){const e=this[K];e.topTlv||P.encode(this),t=await G(e.topTlv),e.topTlvDigest=t}return t}getFullName(){const t=this.getImplicitDigest();if(t)return this[K].name.append(tt,t)}async computeFullName(){return await this.computeImplicitDigest(),this.getFullName()}async canSatisfy(t,{isCacheLookup:e=!1}={}){if(e&&t.mustBeFresh&&this.freshnessPeriod<=0)return!1;if(t.canBePrefix?t.name.isPrefixOf(this.name):t.name.equals(this.name))return!0;if(t.name.length===this.name.length+1&&t.name.get(-1).is(tt)){const e=this.getFullName();return e?t.name.equals(e):t.name.equals(await this.computeFullName())}return!1}async[lt.OP](t){const e=P.encode(this.encodeSignedPortion());this[K].signedPortion=e,this.sigValue=await t(e)}async[dt.OP](t){const{signedPortion:e,sigValue:n}=this[K];if(!n)throw new Error("SigValue is missing");if(!e)throw new Error("SignedPortion is missing");await t(e,n)}}const Tt=["topTlv","topTlvDigest","signedPortion"];J(xt,{name:Tt,contentType:Tt,freshnessPeriod:Tt,finalBlockId:Tt,isFinalBlock:Tt,content:Tt,sigInfo:Tt,sigValue:Tt.slice(0,2)});const kt=Symbol("Data.ctorAssign");!function(t){t.ContentType=function(t){return{[kt]:e=>e.contentType=t}},t.FreshnessPeriod=function(t){return{[kt]:e=>e.freshnessPeriod=t}},t.FinalBlock=Symbol("Data.FinalBlock")}(xt||(xt={}));const St=new q("NackHeader",800).add(801,((t,{nni:e})=>t.reason=e));class Pt{get reason(){return this.reason_}set reason(t){this.reason_=b.constrain(t,"Reason")}reason_=0;static decodeFrom(t){return St.decode(new Pt,t)}constructor(t=0){this.reason=t}encodeTo(t){t.prependTlv(800,this.reason_>0&&[801,b(this.reason_)])}}class Lt{interest;get reason(){return this.header.reason}set reason(t){this.header.reason=t}header;constructor(t,e=150){this.interest=t,this.header="number"==typeof e?new Pt(e):e}}const It=t(e).default;async function*At(t,e){try{yield*t}catch(t){e?.(t)}}async function*_t(t,e){for await(const n of e)yield*t(n)}function Nt(){const t={};return t.promise=new Promise(((e,n)=>{t.resolve=e,t.reject=n})),t}class Rt{buffer;mask;top;btm;next;constructor(t){if(!(t>0)||0!=(t-1&t))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}push(t){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){const t=this.buffer[this.btm];if(void 0!==t)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}isEmpty(){return void 0===this.buffer[this.btm]}}class Dt{size;hwm;head;tail;constructor(t={}){this.hwm=t.splitLimit??16,this.head=new Rt(this.hwm),this.tail=this.head,this.size=0}calculateSize(t){return null!=t?.byteLength?t.byteLength:1}push(t){if(null!=t?.value&&(this.size+=this.calculateSize(t.value)),!this.head.push(t)){const e=this.head;this.head=e.next=new Rt(2*this.head.buffer.length),this.head.push(t)}}shift(){let t=this.tail.shift();if(void 0===t&&null!=this.tail.next){const e=this.tail.next;this.tail.next=null,this.tail=e,t=this.tail.shift()}return null!=t?.value&&(this.size-=this.calculateSize(t.value)),t}isEmpty(){return this.head.isEmpty()}}class Ot extends Error{type;code;constructor(t,e){super(t??"The operation was aborted"),this.type="aborted",this.code=e??"ABORT_ERR"}}function Ut(t={}){return function(t,e){let n,r,s,o=(e=e??{}).onEnd,i=new Dt,a=Nt();const c=t=>null!=r?r(t):(i.push(t),n),u=t=>{if(s)return n;if(!0!==e?.objectMode&&null==t?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:t})},h=t=>s?n:(s=!0,null!=t?(t=>(i=new Dt,null!=r?r({error:t}):(i.push({error:t}),n)))(t):c({done:!0}));if(n={[Symbol.asyncIterator](){return this},next:async()=>{try{return i.isEmpty()?s?{done:!0}:await new Promise(((e,s)=>{r=o=>{r=null,i.push(o);try{e(t(i))}catch(t){s(t)}return n}})):t(i)}finally{i.isEmpty()&&queueMicrotask((()=>{a.resolve(),a=Nt()}))}},return:()=>(i=new Dt,h(),{done:!0}),throw:t=>(h(t),{done:!0}),push:u,end:h,get readableLength(){return i.size},onEmpty:async t=>{const e=t?.signal;if(e?.throwIfAborted(),i.isEmpty())return;let n,r;null!=e&&(n=new Promise(((t,n)=>{r=()=>{n(new Ot)},e.addEventListener("abort",r)})));try{await Promise.race([a.promise,n])}finally{null!=r&&null!=e&&e?.removeEventListener("abort",r)}}},null==o)return n;const f=n;return n={[Symbol.asyncIterator](){return this},next:()=>f.next(),throw:t=>(f.throw(t),null!=o&&(o(t),o=void 0),{done:!0}),return:()=>(f.return(),null!=o&&(o(),o=void 0),{done:!0}),push:u,end:t=>(f.end(t),null!=o&&(o(t),o=void 0),n),get readableLength(){return f.readableLength}},n}((t=>{const e=t.shift();if(null==e)return{done:!0};if(null!=e.error)throw e.error;return{done:!0===e.done,value:e.value}}),t)}function Mt(t){if(t[Symbol.asyncIterator])return async function(t){for await(const e of t);}(t);for(const e of t);}async function*Ct(t,e){for await(const n of e)await t(n)&&(yield n)}function Ft(t,e){return void 0===e?e=>Ct(t,e):Ct(t,e)}async function*Bt(t){for await(const e of t)e&&"string"!=typeof e&&(e[Symbol.iterator]||e[Symbol.asyncIterator])?yield*Bt(e):yield e}async function*zt(t,e){for await(const n of e)yield await t(n)}function $t(t,e){return void 0===e?e=>zt(t,e):zt(t,e)}function Vt(t,e){return void 0===e?e=>Vt(t,e):Ft((t=>null!=t),Bt($t(t,e)))}function qt(t,e,n){const r=function(t){if("function"==typeof t.next)return t;if("function"==typeof t[Symbol.iterator])return t[Symbol.iterator]();if("function"==typeof t[Symbol.asyncIterator])return t[Symbol.asyncIterator]();throw new TypeError('"values" does not to conform to any of the iterator or iterable protocols')}(n),s=[],o=[];let i=!1,a=!1,c=0,u=null;function h(){for(;o.length>0&&s.length>0;){const{resolve:t}=o.shift();t({done:!1,value:s.shift()})}for(;o.length>0&&0===c&&i;){const{resolve:t,reject:e}=o.shift();u?(e(u),u=null):t({done:!0,value:void 0})}}async function f(){if(i)h();else if(!(a||c+s.length>=t)){a=!0,c++;try{const{done:t,value:n}=await r.next();t?(i=!0,c--,h()):async function(t){try{const n=await e(t);if(n&&n[Symbol.asyncIterator])for await(const t of n)s.push(t);else s.push(n)}catch(t){i=!0,u=t}c--,h(),f()}(n)}catch(t){i=!0,c--,u=t,h()}a=!1,f()}}const l={next:async function(){if(0===s.length){const t=function(){let t,e;return{promise:new Promise(((n,r)=>{e=n,t=r})),reject:t,resolve:e}}();return o.push(t),f(),t.promise}const t=s.shift();return f(),{done:!1,value:t}},[Symbol.asyncIterator]:()=>l};return l}function Wt(t,e,n){return void 0===e?(e,n)=>n?Wt(t,e,n):Wt(t,e):void 0===n?n=>Wt(t,e,n):Ft((t=>null!=t),Bt(qt(t,e,n)))}function Ht(t,...e){let n=t();for(const t of e)n=t(n);return n}async function jt(t,e,n){let r=e;for await(const e of n)r=await t(r,e);return r}function Qt(t,e,n){return void 0===e?(e,n)=>n?jt(t,e,n):Qt(t,e):void 0===n?n=>Qt(t,e,n):jt(t,e,n)}async function*Gt(t,e){for await(const n of e)await t(n),yield n}function Xt(t,e){return void 0===e?e=>Gt(t,e):Gt(t,e)}function Yt(t,e){switch(typeof e){case"number":return t.getPrefix(e);case"boolean":return e?t:void 0}return D.from(e)}Symbol("TIMEOUT");class Kt extends s{fw;rxtx;attributes;routes=new z;announcements=new z;running=!0;txQueue=Ut({objectMode:!0});constructor(t,e,n){super(),this.fw=t,this.rxtx=e,this.attributes={local:!1,advertiseFrom:!0,routeCapture:!0,...e.attributes,...n},t.dispatchTypedEvent("faceadd",new we.FaceEvent("faceadd",this)),t.faces.add(this),Ht((()=>this.txLoop()),Xt((e=>t.dispatchPacketEvent("pkttx",this,e))),function(t){return e=>{const n=t;if("function"==typeof n.duplex)return n.duplex(e);const r=t;return r.tx(e),r.rx}}(e),Xt((e=>t.dispatchPacketEvent("pktrx",this,e))),this.rxLoop),e.addEventListener?.("up",this.handleLowerUp),e.addEventListener?.("down",this.handleLowerDown)}close(){if(this.running){this.running=!1,this.rxtx.removeEventListener?.("up",this.handleLowerUp),this.rxtx.removeEventListener?.("down",this.handleLowerDown),this.fw.faces.delete(this);for(const[t]of this.routes.multiplicities())this.fw.fib.delete(this,t.valueHex);for(const[t]of this.announcements.multiplicities())this.fw.readvertise.removeAnnouncement(this,t);this.txQueue.end(new Error("close")),this.dispatchTypedEvent("close",new Event("close")),this.fw.dispatchTypedEvent("facerm",new we.FaceEvent("facerm",this))}}toString(){return this.attributes.describe??"FwFace"}hasRoute(t){const e=D.from(t);return this.routes.count(e)>0}addRoute(t,e=!0){const n=D.from(t);this.fw.dispatchTypedEvent("prefixadd",new we.PrefixEvent("prefixadd",this,n)),1===this.routes.add(n)&&this.fw.fib.insert(this,n.valueHex,this.attributes.routeCapture);const r=Yt(n,e);r&&this.addAnnouncement(r)}removeRoute(t,e=!0){const n=D.from(t),r=Yt(n,e);r&&this.removeAnnouncement(r),0===this.routes.remove(n)&&this.fw.fib.delete(this,n.valueHex),this.fw.dispatchTypedEvent("prefixrm",new we.PrefixEvent("prefixrm",this,n))}addAnnouncement(t){if(!this.attributes.advertiseFrom)return;const e=D.from(t);1===this.announcements.add(e)&&this.fw.readvertise.addAnnouncement(this,e)}removeAnnouncement(t){if(!this.attributes.advertiseFrom)return;const e=D.from(t);0===this.announcements.remove(e)&&this.fw.readvertise.removeAnnouncement(this,e)}send(t){this.running&&this.txQueue.push(t)}handleLowerUp=()=>{this.dispatchTypedEvent("up",new Event("up"))};handleLowerDown=()=>{this.dispatchTypedEvent("down",new Event("down"))};rxLoop=async t=>{for await(const e of Ft((()=>this.running),t))switch(!0){case e.l3 instanceof gt:this.fw[e.cancel?"cancelInterest":"processInterest"](this,e);break;case e.l3 instanceof xt:this.fw.processData(this,e);break;case e.l3 instanceof Lt:this.fw.processNack(this,e)}this.close()};txLoop(){return At(this.txQueue)}}var Jt=n(20);const Zt=t(Jt).default;class te{nexthops=new Map}class ee{table=new Zt((()=>new te));insert(t,e,n){const r=this.table.get(e);T(!r.nexthops.has(t)),r.nexthops.set(t,n)}delete(t,e){const n=this.table.peek(e);T(!!n),n.nexthops.delete(t),0===n.nexthops.size&&this.table.delete(e)}lookup(t){const e=new Set;for(const n of function*(t,e){const n=[""];let r="";for(const e of t.comps)r+=a(e.tlv),n.push(r);for(;n.length>0;){const t=e(n.pop());void 0!==t&&(yield t)}}(t,(t=>this.table.peek(t)))){let t=!1;for(const[r,s]of n.nexthops)e.add(r),t||=s;if(t)break}return e}}var ne,re=function(t){return 1e3*t[0]+t[1]/1e6},se=function(t){return Number(t.toFixed(2))},oe=function(t,e){var n=function(){return se(e())};return n.startedAt=function(){return t},n.seconds=n.s=function(){return se(e()/1e3)},n.milliseconds=n.ms=function(){return se(e())},n.microseconds=n.us=function(){return se(1e3*e())},n.nanoseconds=n.ns=function(){return se(1e6*e())},n},ie="undefined"!=typeof process&&process.hrtime?function(){var t=process.hrtime();return oe(re(t),(function(){return re(process.hrtime(t))}))}:"undefined"!=typeof window&&window.performance?function(){var t=window.performance.now();return oe(t,(function(){return window.performance.now()-t}))}:function(){var t=Date.now();return oe(t,(function(){return Date.now()-t}))};!function(t){t.create=function(t,e){return{l3:t,token:e}},t.isEncodable=function({reject:t,cancel:e}){return!t&&!e}}(ne||(ne={}));class ae{reject;l3;token;constructor(t,e,n){this.reject=t,this.l3=e,this.token=n}}class ce{l3;token;constructor(t,e){this.l3=t,this.token=e}cancel=!0}const ue=t(Jt).default,he=ie();class fe{pit;key;interest;token;dnRecords=new ue((()=>({nRx:0,expire:0,nonce:0,token:void 0})));lastExpire=0;expireTimer;constructor(t,e,n){this.pit=t,this.key=e,this.interest=new gt(n)}receiveInterest(t,{l3:e,token:n}){const r=he(),s=r+e.lifetime,o=e.nonce??gt.generateNonce(),i=this.dnRecords.get(t);++i.nRx,i.expire=s,i.nonce=o,i.token=n,this.updateExpire(r)}cancelInterest(t){const e=this.dnRecords.peek(t);e&&(this.dnRecords.delete(t),this.updateExpire(),t.send(new ae("cancel",this.interest,e.token)))}forwardInterest(t){const e=this.lastExpire-he();e<=0||(this.interest.lifetime=e,t.send(ne.create(this.interest,this.token)))}*returnData(t){clearTimeout(this.expireTimer),this.pit.eraseEntry(this);const e=he();for(const[n,{expire:r,token:s}]of this.dnRecords)r>e&&n!==t&&(yield{dn:n,token:s})}updateExpire(t=he()){let e=0;for(const{expire:t}of this.dnRecords.values())e=Math.max(e,t);e<=t&&(e=0),this.lastExpire!==e&&(this.lastExpire=e,clearTimeout(this.expireTimer),0===this.lastExpire?this.expire():(this.pit.insertEntry(this),this.expireTimer=setTimeout(this.expire,this.lastExpire-t)))}expire=()=>{this.pit.eraseEntry(this);for(const[t,{token:e}]of this.dnRecords)t.send(new ae("expire",this.interest,e))}}class le{dataNoTokenMatch;constructor(t){this.dataNoTokenMatch=t}byName=new Map;byToken=new Map;lastToken=0;generateToken(){do{--this.lastToken,this.lastToken<=0&&(this.lastToken=4294967295)}while(this.byToken.has(this.lastToken));return this.lastToken}insertEntry(t){this.byName.set(t.key,t),t.token??=this.generateToken(),this.byToken.set(t.token,t)}eraseEntry(t){this.byName.delete(t.key),this.byToken.delete(t.token)}close(){for(const t of this.byName.values())clearTimeout(t.expireTimer)}lookup({l3:t},e=!0){const n=`${t.name.valueHex} ${t.canBePrefix?"+":"-"}${t.mustBeFresh?"+":"-"}`;let r=this.byName.get(n);return!r&&e&&(r=new fe(this,n,t)),r}async satisfy(t,{l3:e,token:n}){return await Ht((()=>this.findPotentialMatches(e,n)),Ft((({interest:t})=>e.canSatisfy(t))),Vt((e=>e.returnData(t))),Xt((({dn:t,token:n})=>t.send(ne.create(e,n)))),Qt((t=>t+1),0))>0}*findPotentialMatches(t,e){if("number"==typeof e){const t=this.byToken.get(e);return void(t&&(yield t))}if(!this.dataNoTokenMatch)return;let n=[" ++"," +-"," -+"," --"];for(let e=t.name;e.length>0;e=e.getPrefix(-1)){const t=e.valueHex;for(const e of n){const n=this.byName.get(t+e);n&&(yield n)}n=[" ++"," +-"]}}}var de=n(353);const pe=t(de).default;class me{fw;constructor(t){this.fw=t}announcements=new B;destinations=new Set;addAnnouncement(t,e){if(!(this.announcements.add(e,t)>1)){this.fw.dispatchTypedEvent("annadd",new we.AnnouncementEvent("annadd",e));for(const t of this.destinations)t.advertise(e)}}removeAnnouncement(t,e){if(!(this.announcements.remove(e,t)>0)){this.fw.dispatchTypedEvent("annrm",new we.AnnouncementEvent("annrm",e));for(const t of this.destinations)t.withdraw(e)}}close(){for(const t of this.destinations)t.disable()}}class ye{retryOptions;readvertise;table=new F;queue=Ut({objectMode:!0});closed=!1;constructor(t={forever:!0,minTimeout:5e3,maxTimeout:6e4,randomize:!0}){this.retryOptions=t}enable(t){this.readvertise=t.readvertise,this.readvertise.destinations.add(this);for(const[t]of this.readvertise.announcements.associations())this.queue.push(t);this.process()}disable(){this.readvertise?.destinations.delete(this),this.readvertise=void 0;for(const[t,e]of this.table)this.queue.push(t),e.status=ye.Status.WITHDRAWING;this.queue.end(),this.closed=!0}advertise(t){let e=this.table.get(t);e||(e={status:ye.Status.ADVERTISING,state:this.makeState(t)},this.table.set(t,e)),e.status=ye.Status.ADVERTISING,this.restart(t,e)}withdraw(t){const e=this.table.get(t);e&&(e.status=ye.Status.WITHDRAWING,this.restart(t,e))}restart(t,e){e.retry?.stop(),e.retry=pe.operation(this.retryOptions),e.retry.attempt((()=>{this.closed?e.retry.stop():this.queue.push(t)}))}async process(){for await(const t of this.queue){const e=this.table.get(t);if(!e)continue;const{status:n,retry:r,state:s}=e;switch(n){case ye.Status.ADVERTISING:try{await this.doAdvertise(t,s),e.status===ye.Status.ADVERTISING&&(e.status=ye.Status.ADVERTISED,r.stop())}catch(t){r.retry(t)}break;case ye.Status.WITHDRAWING:try{await this.doWithdraw(t,s),e.status===ye.Status.WITHDRAWING&&(e.status=ye.Status.WITHDRAWN,r.stop(),this.table.delete(t))}catch(t){r.retry(t)}}}}makeState(t){return{}}}var we;!function(t){let e;!function(t){t[t.ADVERTISING=0]="ADVERTISING",t[t.ADVERTISED=1]="ADVERTISED",t[t.WITHDRAWING=2]="WITHDRAWING",t[t.WITHDRAWN=3]="WITHDRAWN"}(e=t.Status||(t.Status={}))}(ye||(ye={})),function(t){let e;t.DefaultOptions={dataNoTokenMatch:!0},t.create=function(e){return new ge({...t.DefaultOptions,...e})},t.getDefault=function(){return e||(e=t.create()),e},t.replaceDefault=function(t){e=t},t.deleteDefault=function(){e&&(e.close(),e=void 0)};class n extends Event{face;constructor(t,e){super(t),this.face=e}}t.FaceEvent=n;class r extends Event{face;prefix;constructor(t,e,n){super(t),this.face=e,this.prefix=n}}t.PrefixEvent=r;class s extends Event{name;constructor(t,e){super(t),this.name=e}}t.AnnouncementEvent=s;class o extends Event{face;packet;constructor(t,e,n){super(t),this.face=e,this.packet=n}}t.PacketEvent=o}(we||(we={}));class ge extends s{opts;nodeNames=[];faces=new Set;fib=new ee;pit;readvertise=new me(this);maybeHaveEventListener=function(t){const e={},n=t.addEventListener;return r(n),Object.defineProperty(t,"addEventListener",{configurable:!0,value(...t){e[t[0]]=!0,n.call(this,...t)}}),e}(this);constructor(t){super(),this.opts=t,this.pit=new le(t.dataNoTokenMatch)}addFace(t,e={}){return new Kt(this,t,e)}pickInterestForwardingName(t){const e=t.fwHint?.delegations[0];return e&&this.nodeNames.every((t=>!e.isPrefixOf(t)))?e:t.name}processInterest(t,e){const n=this.pit.lookup(e);n.receiveInterest(t,e);const r=this.pickInterestForwardingName(e.l3);for(const e of this.fib.lookup(r))e!==t&&n.forwardInterest(e)}cancelInterest(t,e){const n=this.pit.lookup(e,!1);n?.cancelInterest(t)}processData(t,e){this.pit.satisfy(t,e)}processNack(t,e){}close(){this.pit.close(),this.readvertise.close();for(const t of this.faces)t.close()}dispatchPacketEvent(t,e,n){this.maybeHaveEventListener[t]&&this.dispatchTypedEvent(t,new we.PacketEvent(t,e,n))}}function ve(t){return t?"number"==typeof t?ve({limit:t}):"function"==typeof t?t:function*(e){const{limit:n=0,interval:r=.5*e,randomize:s=.1,backoff:o=1,max:i=.9*e}=t,a=function(t,e=1){const n=1-(t=Math.max(0,Math.min(t,1))),r=2*t;return()=>e*(n+r*Math.random())}(s);let c=r;for(let t=0;t<n;++t)yield c*a(),c=Math.min(c*o,i)}:()=>[]}const be=t(n(917)).default;class Ee{opts;fw;constructor(t={}){this.opts=t,this.fw=t.fw??we.getDefault()}}be(Ee,[class{consume(t,e={}){const n=t instanceof gt?t:new gt(t),{describe:r=`consume(${n.name})`,signal:s,modifyInterest:o,retx:i,verifier:a}={...this.opts,...e};gt.makeModifyFunc(o)(n);let c=-1;const u=ve(i)(n.lifetime)[Symbol.iterator](),h=new Promise(((t,e)=>{const o=Ut({objectMode:!0});let i;const h=()=>{clearTimeout(i),i=void 0},f=()=>{h();const{value:t,done:e}=u.next();e||(i=setTimeout(f,t)),o.push(ne.create(n)),++c},l=()=>{h(),o.push(new ce(n))};s?.addEventListener("abort",l),this.fw.addFace({rx:o,async tx(n){for await(const s of n){if(s.l3 instanceof xt){try{await(a?.verify(s.l3))}catch(t){e(new Error(`Data verify failed: ${t} @${r}`));break}t(s.l3);break}if(s.reject&&!i){e(new Error(`Interest rejected: ${s.reject} @${r}`));break}}h(),s?.removeEventListener("abort",l),o.end()}},{describe:r,local:!0}),f()}));return Object.defineProperties(h,{interest:{value:n},nRetx:{get:()=>c}})}},class{produce(t,e,n={}){const r=void 0===t?void 0:new D(t),{describe:s=`produce(${r})`,signal:o,routeCapture:i=!0,announcement:a,concurrency:c=1,dataSigner:u,dataBuffer:h,autoBuffer:f=!0}={...this.opts,...n};let l;const d=async t=>{const n=await e(t,l);if(n instanceof xt&&(await async function(t,e){e&&200===t.sigInfo.type&&await e.sign(t)}(n,u),await n.canSatisfy(t)))return n};let p=d;h&&(p=async t=>{let e=await h.find(t);if(!e){const n=await d(t);if(n)return f&&await h.insert(n),n;e=await h.find(t)}return e});const m=this.fw.addFace({duplex:Wt(c,(async function*({l3:t,token:e}){if(!(t instanceof gt))return;const n=await p(t).catch((()=>{}));n&&(yield ne.create(n,e))}))},{describe:s,local:!0,routeCapture:i});r&&m.addRoute(r,a);const y=()=>{m.close(),o?.removeEventListener("abort",y)};return o?.addEventListener("abort",y),l={prefix:r,face:m,dataBuffer:h,processInterest:p,close:y},l}}]),function(t){t.deleteDefaultForwarder=we.deleteDefault}(Ee||(Ee={}));const xe=new class{conventions;constructor(t){this.conventions=t}ofComponent=t=>{for(const e of this.conventions)if(e.match(t))return e.toAltUri(t);return t.toString()};ofName=t=>`/${t.comps.map((t=>this.ofComponent(t))).join("/")}`;parseComponent=t=>{for(const e of this.conventions){const n=e.fromAltUri(t);if(n)return n}return R.from(t)};parseName=t=>new D(t,this.parseComponent)}([new class{match({type:t}){return 8===t}create(){throw new TypeError("not supported")}parse(){throw new TypeError("not supported")}toAltUri(t){return t.toString().slice(2)}fromAltUri(){}},tt,nt]);class Te{attributes;constructor(t){this.attributes=t}get mtu(){return 1200}reopen(){return Promise.reject(new Te.ReopenNotSupportedError)}toString(){return this.attributes.describe??this.constructor.name}}!function(t){class e extends Error{constructor(){super("reopen not supported")}}t.ReopenNotSupportedError=e}(Te||(Te={}));var ke=n(217);const Se=100,Pe=80,Le=81,Ie=82,Ae=83,_e=98,Ne=800,Re=new q("LpPacket",Se).setIsCritical((function(t){return!(t>=800&&t<=959&&t%4==0)})).add(Le,((t,{value:e})=>t.fragSeqNum=l(e).getBigUint64(0))).add(Ie,((t,{nni:e})=>t.fragIndex=e)).add(Ae,((t,{nni:e})=>t.fragCount=e)).add(_e,((t,{value:e})=>t.pitToken=e)).add(Ne,((t,{decoder:e})=>t.nack=e.decode(Pt))).add(Pe,((t,{value:e})=>t.payload=e));class De{static decodeFrom(t){return Re.decode(new De,t)}fragSeqNum;fragIndex=0;fragCount=1;pitToken;nack;payload;encodeTo(t){t.prependTlv(Se,void 0!==this.fragSeqNum&&[Le,b(this.fragSeqNum,{len:8})],this.fragIndex>0&&[Ie,b(this.fragIndex)],this.fragCount>1&&[Ae,b(this.fragCount)],...this.encodeL3Headers(),[Pe,P.OmitEmpty,this.payload])}encodeL3Headers(){return[[_e,P.OmitEmpty,this.pitToken],this.nack]}copyL3HeadersFrom(t){this.pitToken=t.pitToken,this.nack=t.nack}}class Oe{current=BigInt(Math.trunc(4294967296*Math.random()))<<32n|BigInt(Math.trunc(4294967296*Math.random()));next(){return this.current=BigInt.asUintN(64,this.current+1n),this.current}}class Ue{seqNumGen=new Oe;fragment(t,e){const n=e-26,r=P.encode(t.encodeL3Headers()).length,s=t.payload?.byteLength??0,o=Math.min(s,n-r);if(o===s)return[t];if(o<=0)return[];const i=[],a=new De;a.copyL3HeadersFrom(t),a.fragSeqNum=this.seqNumGen.next(),a.payload=t.payload.subarray(0,o),i.push(a);for(let e=o;e<s;e+=n){const r=new De;r.fragSeqNum=this.seqNumGen.next(),r.fragIndex=i.length,r.payload=t.payload.subarray(e,e+n),i.push(r)}for(const t of i)t.fragCount=i.length;return i}}class Me{seqNumBase;constructor(t){this.seqNumBase=t}buffer=[];accepted=0;payloadLength=0;accept(t){return 0===this.accepted?(this.buffer.length=t.fragCount,void this.acceptOne(t)):t.fragCount===this.buffer.length&&(this.buffer[t.fragIndex]?void 0:(this.acceptOne(t),this.accepted===this.buffer.length?this.reassemble():void 0))}acceptOne(t){this.buffer[t.fragIndex]=t,++this.accepted,this.payloadLength+=t.payload?.length??0}reassemble(){const t=new De;t.copyL3HeadersFrom(this.buffer[0]);const e=[];for(const t of this.buffer){const n=t?.payload;n&&e.push(n)}return t.payload=function(t,e){e??=t.reduce(((t,{byteLength:e})=>t+e),0);const n=new Uint8Array(e);let r=0;for(const e of t)n.set(e,r),r+=e.byteLength;return W.equal(r,e),n}(e,this.payloadLength),t}}class Ce{capacity;constructor(t){this.capacity=t}partials=new Map;accept(t){if(1===t.fragCount)return t;if(void 0===t.fragSeqNum||t.fragIndex>=t.fragCount)return;const e=BigInt.asUintN(64,t.fragSeqNum-BigInt(t.fragIndex)),n=this.getPartial(e),r=n.accept(t);if(r)return r;!1!==r&&this.putPartial(n)}getPartial(t){const e=this.partials.get(t);return e?(this.partials.delete(t),e):new Me(t)}putPartial(t){this.partials.set(t.seqNumBase,t),function(t,e){It(t>=0);for(const n of e.keys()){if(e.size<=t)break;e.delete(n)}}(this.capacity,this.partials)}}const Fe=t(ke).default,Be=P.encode(new De);class ze{transport;constructor({keepAlive:t=6e4,mtu:e=1/0,reassemblerCapacity:n=16},r){this.transport=r,Number.isFinite(t)&&t>0&&(this.keepAlive=Math.ceil(t)),this.mtu=e,this.reassembler=new Ce(n)}keepAlive;mtu;fragmenter=new Ue;reassembler;rx=t=>_t((t=>this.decode(t)),t);*decode(t){const{type:e,decoder:n,tlv:r}=t;try{if(e!==Se)return void(yield this.decodeL3(t));const r=n.decode(De),s=this.reassembler.accept(r);if(!s?.payload)return;const o=this.decodeL3(new x(s.payload).read());if(s.nack){if(!(o.l3 instanceof gt))throw new Error("Nack can only appear on Interest");o.l3=new Lt(o.l3,s.nack)}o.token=s.pitToken,yield o}catch(t){yield new ze.RxError(t,r)}}decodeL3({type:t,decoder:e}){switch(t){case 5:return{l3:e.decode(gt)};case 6:return{l3:e.decode(xt)};default:throw new Error(`unrecognized TLV-TYPE ${$(t)} as L3Pkt`)}}tx=t=>_t((t=>this.encode(t)),this.keepAlive?Fe((()=>!1),{timeout:this.keepAlive})(t):t);*encode(t){if(!1===t)return void(yield Be);const e=Math.min(this.mtu,this.transport.mtu),{l3:n,token:r}=t,s=new De;s.pitToken=r;try{if(n instanceof gt||n instanceof xt){const t=P.encode(n);if(!r&&t.length<=e)return yield t;s.payload=t}else T(n instanceof Lt),s.nack=n.header,s.payload=P.encode(n.interest)}catch(t){return yield new ze.TxError(t,n)}Number.isFinite(e)?yield*this.fragmenter.fragment(s,e).map((t=>P.encode(t,e))):yield P.encode(s)}}!function(t){class e extends Error{packet;constructor(t,e){super(`${t.message} ${a(e)}`),this.packet=e}}t.RxError=e;class n extends Error{packet;constructor(t,e){super(`${t.message} ${e instanceof Lt?e.interest.name:e.name}`),this.packet=e}}t.TxError=n}(ze||(ze={}));class $e extends Error{constructor(t,e){super(t??"The operation was aborted"),this.type="aborted",this.code=e??"ABORT_ERR"}}function Ve(t,e,n){const r=n??{},s=function(t){if(null!=t){if("function"==typeof t[Symbol.iterator])return t[Symbol.iterator]();if("function"==typeof t[Symbol.asyncIterator])return t[Symbol.asyncIterator]();if("function"==typeof t.next)return t}throw new Error("argument is not an iterator or iterable")}(t);return async function*(){let n;const o=()=>{null!=n&&n()};for(e.addEventListener("abort",o);;){let i;try{if(e.aborted){const{abortMessage:t,abortCode:e}=r;throw new $e(t,e)}const t=new Promise(((t,e)=>{n=()=>{const{abortMessage:t,abortCode:n}=r;e(new $e(t,n))}}));i=await Promise.race([t,s.next()]),n=null}catch(n){e.removeEventListener("abort",o);const i="aborted"===n.type&&e.aborted;if(i&&null!=r.onAbort&&r.onAbort(t),"function"==typeof s.return)try{const t=s.return();t instanceof Promise&&t.catch((t=>{null!=r.onReturnError&&r.onReturnError(t)}))}catch(t){null!=r.onReturnError&&r.onReturnError(t)}if(i&&!0===r.returnOnAbort)return;throw n}if(!0===i.done)break;yield i.value}e.removeEventListener("abort",o)}()}const qe=t(de).default;class We extends s{transport;attributes;lp;rx;wireTokenPrefix=Math.trunc(65536*Math.random());get state(){return this.state_}set state(t){if(t===this.state_)return;const e=new We.StateEvent("state",t,this.state_);switch(this.state_=t,this.dispatchTypedEvent("state",e),t){case We.State.UP:this.dispatchTypedEvent("up",new Event("up"));break;case We.State.DOWN:{const t=this.lastError instanceof Error?this.lastError:new Error(`${this.lastError??"unknown error"}`);this.dispatchTypedEvent("down",new Q("down",{detail:t})),this.lastError=void 0;break}case We.State.CLOSED:this.dispatchTypedEvent("close",new Event("close"))}}state_=We.State.UP;lastError;rxSources=Ut({objectMode:!0});reopenRetry;constructor(t,e={},n={}){super(),this.transport=t,this.attributes={describe:`L3Face(${t})`,advertiseFrom:!1,...t.attributes,...e},this.lp=new ze(n,t),this.rx=this.makeRx()}async*makeRx(){for await(const t of this.rxSources)try{yield*this.rxTransform(t),this.lastError=new Error("RX ending"),this.state=We.State.DOWN}catch(t){t instanceof $e||(this.lastError=t,this.state=We.State.DOWN)}}async*rxTransform(t){yield*Ht((()=>t),this.lp.rx,Ft((t=>!(t instanceof ze.RxError&&(this.dispatchTypedEvent("rxerror",new Q("rxerror",{detail:t})),1)))),$t((({l3:t,token:e})=>{let n;if(t instanceof gt)n=e;else if(6===e?.length){const t=l(e);t.getUint16(0)===this.wireTokenPrefix&&(n=t.getUint32(2))}return ne.create(t,n)})))}txTransform(t){return Ht((()=>t),Ft((t=>ne.isEncodable(t))),$t((({l3:t,token:e})=>{let n;if("number"==typeof e){n=new Uint8Array(6);const t=l(n);t.setUint16(0,this.wireTokenPrefix),t.setUint32(2,e)}else e instanceof Uint8Array&&(n=e);return{l3:t,token:n}})),this.lp.tx,Ft((t=>!(t instanceof ze.TxError&&(this.dispatchTypedEvent("txerror",new Q("txerror",{detail:t})),1)))))}tx=async t=>{const e=this.txTransform(t)[Symbol.asyncIterator](),n={[Symbol.asyncIterator]:()=>({next:()=>e.next()})};for(;this.state!==We.State.CLOSED;){this.state===We.State.DOWN&&this.reopenTransport();const t=new AbortController,e=()=>t.abort();this.addEventListener("state",e,{once:!0});try{const e=Ve(n,t.signal);this.state===We.State.UP?(this.rxSources.push(Ve(this.transport.rx,t.signal)),await this.transport.tx(e)):await Mt(e),this.state=We.State.CLOSED}catch(t){t instanceof $e||(this.lastError=t,this.state=We.State.DOWN)}finally{t.abort(),this.removeEventListener("state",e)}}this.reopenRetry?.stop(),this.rxSources.end()};reopenTransport(){this.reopenRetry?.stop(),this.reopenRetry=qe.operation({forever:!0,minTimeout:100,maxTimeout:6e4,randomize:!0}),this.reopenRetry.attempt((async()=>{try{this.transport=await this.transport.reopen()}catch(t){return void(t instanceof Te.ReopenNotSupportedError||this.reopenRetry.retry(t))}this.state!==We.State.CLOSED?(this.reopenRetry.stop(),this.state=We.State.UP):this.transport.tx(async function*(){}())}))}}!function(t){let e;!function(t){t[t.UP=0]="UP",t[t.DOWN=1]="DOWN",t[t.CLOSED=2]="CLOSED"}(e=t.State||(t.State={}));class n extends Event{state;prev;constructor(t,e,n){super(t),this.state=e,this.prev=n}}function r(t,e=["/"]){for(const n of e)t.addRoute(n)}t.StateEvent=n,t.makeCreateFace=function(e){return async(n,...s)=>{const o=await e(...s),{fw:i=we.getDefault(),addRoutes:a,l3:c,lp:u,callback:h}=n,f=e=>{const n=new t(e,{advertiseFrom:!1,...c},u),s=i.addFace(n);return r(s,a),h?.(e,n,s),s};return Array.isArray(o)?o.map(f):f(o)}},t.processAddRoutes=r}(We||(We={}));const He=t(n(507)).default;class je extends Te{sock;opts;rx;highWaterMark;lowWaterMark;constructor(t,e){super({describe:`WebSocket(${t.url})`}),this.sock=t,this.opts=e,t.binaryType="arraybuffer",this.rx=async function*(t){for await(const e of At(t)){const t=new x(e);let n;try{n=t.read()}catch{continue}yield n}}(new He((({push:e,stop:n})=>{const r=t=>{e(function(t){return new Uint8Array(t.data)}(t))};return t.addEventListener("message",r),t.addEventListener("close",n),()=>{t.removeEventListener("message",r),t.removeEventListener("close",n)}}))),this.highWaterMark=e.highWaterMark??1048576,this.lowWaterMark=e.lowWaterMark??16384}close(){this.sock.close()}get mtu(){return 1/0}tx=async t=>{try{for await(const e of t){if(this.sock.readyState!==this.sock.OPEN)throw new Error(`unexpected WebSocket.readyState ${this.sock.readyState}`);this.sock.send(e),this.sock.bufferedAmount>this.highWaterMark&&await this.waitForTxBuffer()}}finally{this.close()}};waitForTxBuffer(){return new Promise((t=>{const e=setInterval((()=>{(this.sock.bufferedAmount<=this.lowWaterMark||this.sock.readyState!==this.sock.OPEN)&&(clearInterval(e),t())}),100)}))}reopen(){return je.connect(this.sock.url,this.opts)}}async function Qe(t){t.preventDefault();const e=document.querySelector("#app_button");e.disabled=!0;try{const t=new D(document.querySelector("#app_prefix").value),e=document.querySelector("#app_param").value,n=document.querySelector("#app_log");n.textContent=`Check Data \n${xe.ofName(t)}\n`;const r=new Ee,s=new TextEncoder;let o=Math.trunc(1e8*Math.random());for(let i=0;i<3;++i){++o;const i=new gt;i.name=t,i.mustBeFresh=!0,i.lifetime=1e3,i.appParameters=s.encode(e),n.textContent+=`\n${s.encode(e)}\n`;const a=Date.now();await i.updateParamsDigest();try{const t=await r.consume(i),e=Date.now()-a,s=t.content;n.textContent+=`${xe.ofName(t.name)} rtt= ${e}ms content= ${String.fromCharCode(...s)}\n`,console.log(`${e} ms`)}catch(t){n.textContent+=`\n${xe.ofName(i.name)} ${t}`}await new Promise((t=>setTimeout(t,500)))}}finally{e.disabled=!1}}!function(t){function e(e,n={}){const{connectTimeout:r=1e4,signal:s}=n;return new Promise(((o,i)=>{const a="string"==typeof e?function(t){return new WebSocket(t,[])}(e):e;if(a.readyState===a.OPEN)return void o(new t(a,n));let c;const u=t=>{clearTimeout(c),a.close(),i(t)};c=setTimeout((()=>u(new Error("connectTimeout"))),r);const h=()=>u(new Error("abort"));s?.addEventListener("abort",h);const f=t=>{a.close(),i(new Error(t.message))};a.addEventListener("error",f),a.addEventListener("open",(()=>{clearTimeout(c),a.removeEventListener("error",f),s?.removeEventListener("abort",h),o(new t(a,n))}))}))}t.connect=e,t.createFace=We.makeCreateFace(e)}(je||(je={})),window.addEventListener("load",(async function(){(await je.createFace({},"wss://scbe.ndntel-u.my.id:9696")).addRoute(new D("/")),document.querySelector("#app_button").disabled=!1,document.querySelector("#app_form").addEventListener("submit",Qe)}))})()})();
//# sourceMappingURL=bundle.js.map